# Thực hành triển khai các tác vụ trên Proxmox
## Tạo VM
#### Bước 1: Mở Giao Diện Create VM

- Truy cập vào Proxmox Web UI, sau đó chọn Datacenter > Node (ví dụ: nvtuprx).

- Nhấn vào Create VM trên giao diện chính của Proxmox.

#### Bước 2: Điền Thông Tin Tổng Quan Cho Máy Ảo

- Node: Chọn nvtuprx (Node bạn đang sử dụng).

- VM ID: Nhập ID cho máy ảo (ví dụ: 103 hoặc 104).

- Name: Nhập tên máy ảo, ví dụ task-vm.

- Add to HA: Nếu bạn muốn máy ảo tham gia vào High Availability, đánh dấu vào ô này.

#### Bước 3: Cấu Hình Hệ Điều Hành (OS)

- OS Type: Chọn Linux (hoặc hệ điều hành bạn muốn cài).

- Version: Chọn hệ điều hành bạn định cài đặt (ví dụ: Ubuntu 64-bit).

- ISO Image: Chọn ISO bạn đã tải lên (ví dụ: ubuntu-20.04.2-live-server-amd64.iso).

#### Bước 4: Cấu Hình Hệ Thống

- BIOS: Chọn SeaBIOS (hoặc UEFI nếu cần).

- Machine type: Chọn i440FX.

- SCSI Controller: Chọn LSI Logic Parallel (hoặc tùy chỉnh).

#### Bước 5: Cấu Hình Đĩa (Disk)

- Trong phần Disks, chọn storage là sdc để đĩa của máy ảo được lưu trữ trên storage sdc.

- Disk size: Chọn dung lượng cho đĩa, ví dụ: 10GB.

- Disk format: Chọn raw (hoặc qcow2 nếu bạn cần tính năng snapshot).

- Cache: Chọn default hoặc writeback.

#### Bước 6: Cấu Hình CPU và RAM

- Cores: Chọn số lượng CPU cores (ví dụ: 2 cores).

- Sockets: Để mặc định 1 socket.

- RAM: Chọn dung lượng RAM cho máy ảo, ví dụ: 2GB hoặc 4GB.

#### Bước 7: Cấu Hình Mạng

- Interface: Chọn Bridge mode để máy ảo có thể kết nối với mạng.

- Bridge: Chọn vmbr0 hoặc bridge bạn đã cấu hình cho máy chủ.

- Model: Chọn virtio để có hiệu suất mạng tốt hơn.

#### Bước 8: Xác Nhận và Hoàn Tất

- Kiểm tra lại tất cả các cài đặt và nhấn Finish để hoàn tất quá trình tạo máy ảo.

<img width="1919" height="735" alt="image" src="https://github.com/user-attachments/assets/ffc17bea-4e71-4b37-a045-1dd015e7e9ab" />

##  Move disk VM giữa các data storage
### Bước 1: Tạo một sdd
#### Mount ổ sdd
Chạy lệnh trên Proxmox

- Tạo Physical Volume:
```yaml
pvcreate /dev/sdd
```
- Kiểm tra:
```yaml
pvs
```
- Tạo Volume Group mới:
```yaml
vgcreate vg_sdd /dev/sdd
```
- Kiểm tra:
```yaml
vgs
```
- Tạo Thin Pool:
```yaml
lvcreate -l 100%FREE -T vg_sdd/data
```
- Kiểm tra:
```yaml
lvs
```

<img width="959" height="644" alt="image" src="https://github.com/user-attachments/assets/8b169ec7-5d7f-4215-b6bc-02889f79bf4e" />

- Vào **Datacenter** add Storage sdd vào vg_sdd

<img width="1910" height="757" alt="image" src="https://github.com/user-attachments/assets/6e0eab4b-dedc-4a73-b029-a9a4a2e4d7ef" />

- Kết quả:

<img width="1919" height="739" alt="image" src="https://github.com/user-attachments/assets/4233a946-72cb-4a68-99f9-f60e4e629eb2" />


#### Bước 2: Move VM sang một storage khác
- Vào **Datacenter**, vào note (**nvtuprx**), sau đó chọn máy ảo cần Move => vào **Hard ware**

<img width="444" height="184" alt="image" src="https://github.com/user-attachments/assets/a536a62f-2b33-4288-9895-d9ef65653d51" />

- Chọn Hard Disk (scsi0), vào **Disk Action**, chọn **Move Storage**

<img width="349" height="212" alt="image" src="https://github.com/user-attachments/assets/c67e4465-dfab-49b9-a5d3-bb764e6ce2ae" />

<img width="798" height="492" alt="image" src="https://github.com/user-attachments/assets/c773be14-2edc-47aa-85cc-840bea7c43eb" />

- Kết quả sẽ thấy máy ảo đã được move sang Storage ssd
<img width="1917" height="734" alt="image" src="https://github.com/user-attachments/assets/f107c622-370e-4c84-a33b-daee613cbc02" />


## Backup/Restore VM
### Backup VM
#### 1. Đăng nhập vào giao diện web Proxmox:
- Truy cập vào Proxmox qua trình duyệt web của bạn.

#### 2. Chọn máy ảo (VM):

- Trong phần **Datacenter -> Node** (ví dụ: nvtuprx), tìm và chọn VM 102 mà bạn muốn sao lưu.

#### 3. Đi đến tab "Backup":

- Chọn tab **Backup** ở phía trên của cửa sổ máy ảo.

#### 4. Chọn "Backup Now":

- Bấm vào nút **Backup Now** để bắt đầu tạo bản sao lưu cho máy ảo.

#### 5. Chọn các tùy chọn Backup:

- **Storage**: Chọn nơi bạn muốn lưu bản sao lưu, ví dụ như local, backupPVE, hoặc một storage khác mà bạn đã cấu hình.

- **Mode**: Chọn chế độ sao lưu:

  - **Stop**: Máy ảo sẽ được tắt khi sao lưu, đảm bảo sao lưu đồng bộ dữ liệu.

  - **Suspend**: Máy ảo sẽ tạm dừng trong khi sao lưu, giúp giảm thiểu gián đoạn.

  - **Snapshot**: Máy ảo vẫn chạy trong khi sao lưu (sao lưu theo kiểu snapshot).

Sau khi chọn các tùy chọn phù hợp, bấm **Backup**.


<img width="794" height="499" alt="image" src="https://github.com/user-attachments/assets/2c43e4fc-314d-476b-8e97-32dc317e551b" />


Kiểm tra lại Backup:

Sau khi sao lưu hoàn tất, bạn có thể kiểm tra bản sao lưu trong **Datacenter -> Storage -> backupPVE (hoặc storage bạn đã chọn)** để đảm bảo rằng file backup đã được tạo thành công.


<img width="1919" height="730" alt="image" src="https://github.com/user-attachments/assets/c38086c7-013f-474e-8ba0-204a2252f8f9" />


### Restore VM

#### 1. Vào phần Datacenter -> Storage:

- Trong giao diện Proxmox, ở phần **Datacenter**, chọn **Storage**.

- Chọn nơi bạn đã lưu bản sao lưu máy ảo (ví dụ: backupPVE, local, v.v.).

#### 2. Chọn Backup:

- Trong danh sách **Storage**, chọn tab **Backup** để hiển thị các bản sao lưu đã có.

- Tìm bản sao lưu của máy ảo bạn muốn khôi phục (ví dụ: VM 102).

#### 3. Restore máy ảo:

- Chọn bản sao lưu cần khôi phục.

- Nhấn vào **Restore** (nút phía trên của màn hình).

- Chọn ID máy ảo (VMID) mới nếu bạn muốn restore lại với ID khác (hoặc giữ nguyên).

- Bạn cũng có thể chọn các storage đích (để xác định nơi máy ảo sẽ được khôi phục lại).

#### 4. Xác nhận Restore:

- Sau khi chọn xong các tùy chọn, nhấn Restore để bắt đầu quá trình khôi phục.

- Quá trình restore sẽ mất một chút thời gian tùy thuộc vào dung lượng của bản sao lưu.


<img width="1919" height="735" alt="image" src="https://github.com/user-attachments/assets/98d165ca-4b60-424f-acc4-2dcf91e0c87e" />


<img width="798" height="498" alt="image" src="https://github.com/user-attachments/assets/0a1d19fc-69ab-41be-ac8e-6a923e0c019c" />

#### 5. Kiểm tra lại máy ảo:

Sau khi quá trình khôi phục hoàn tất, bạn có thể vào lại **Datacenter -> Node** và chọn VM 102 để kiểm tra máy ảo đã được restore thành công hay chưa.

## Cloud init
### Bước 1: Tạo một máy ảo mới từ Cloud Image

#### 1. Đăng nhập vào Giao Diện Web của Proxmox:

- Truy cập vào giao diện quản lý Proxmox qua trình duyệt.

#### 2. Tạo máy ảo mới:

- Vào **Datacenter -> Node** (Chọn node bạn muốn tạo máy ảo).

- Click vào **Create VM** ở góc trên bên phải.

#### 3. Chọn hệ điều hành (OS):

- Trong phần OS, thay vì chọn một ISO file như bình thường, bạn sẽ chọn **Cloud Image**. **Cloud Image** cho hệ điều hành như Ubuntu, CentOS, hoặc Debian đã được cấu hình sẵn để hỗ trợ Cloud-init.

<img width="714" height="535" alt="image" src="https://github.com/user-attachments/assets/ba73be2c-d6ea-42a9-b1f2-c5a909be6199" />
<img width="715" height="536" alt="image" src="https://github.com/user-attachments/assets/b72e0aff-12c3-489c-a07c-74563ac70c83" />

- Vào **Hardware**, xóa **CD/DVD Driver**

<img width="1871" height="730" alt="image" src="https://github.com/user-attachments/assets/05051bae-5125-414d-a3bf-d175635de71c" />

- Vào **Add**, chọn **CloudInit Driver** => Chọn Storage sau đó Add

- Để sử dụng Ubuntu Cloud Image, bạn có thể tải về trực tiếp từ **Ubuntu Cloud Images**.
- Vào Shell:
```yaml
wget https://cloud-images.ubuntu.com/noble/current/noble-server-cloudimg-amd64.img
```
<img width="972" height="48" alt="image" src="https://github.com/user-attachments/assets/a7ab7aa5-17ca-4309-92d5-32348c2654d7" />

<img width="1380" height="202" alt="image" src="https://github.com/user-attachments/assets/e76bbca8-2bfa-4dc8-9c8b-04ee4da6c94a" />

- Chạy lần lượt các câu lệnh sau để cài Cloud Images

```yaml
ls
```
```yaml
mv noble-server-cloudimg-amd64.img ubuntu-cloudinit.qcow2
```
```waml
ls
```
```yaml
qemu-img resize ubuntu-cloudinit.qcow2 32G
```


- Proxmox sẽ hỗ trợ các hệ điều hành như Ubuntu, Debian, CentOS, v.v.

**Lưu ý**: Nếu bạn đã có **Cloud Image** lưu trữ trên Proxmox, bạn có thể chọn chúng từ **Local Storage**.

#### 4. Cấu hình phần cứng cho máy ảo:

- Tiếp theo, bạn sẽ cấu hình phần cứng cho máy ảo của mình (CPU, RAM, Disk, Network...).

```yaml
qm importdisk 1000 ubuntu-cloudinit.qcow2 sdd
```
```yaml
qm set 1000 --serial0 socket --vga serial0
```

- **Storage**: Bạn sẽ chọn nơi lưu trữ đĩa hệ điều hành cho máy ảo (ví dụ: local, local-lvm, hoặc một storage khác đã được cấu hình).
- Add **Unused Disk**

<img width="954" height="717" alt="image" src="https://github.com/user-attachments/assets/99e3c150-c900-4c17-ae4a-0d5016b4e9e9" />

- Sau đó vào **Option** chọn **Boot Order** tích **Enabled** vào **scsi0**

<img width="955" height="713" alt="image" src="https://github.com/user-attachments/assets/e8da1788-2cbe-47c5-a2c0-a5f259a57bbe" />

-Cuối cùng, click chuột phải vào máy ảo chọn **Convert to template**

<img width="954" height="713" alt="image" src="https://github.com/user-attachments/assets/67ff1638-799f-4641-bd14-5e716372f11a" />




#### 5. Hoàn tất quá trình tạo máy ảo:

- Sau khi đã cấu hình các thông số cho máy ảo (bao gồm cả phần Cloud-init), bấm Finish để tạo máy ảo.


### Bước 2: Cấu hình Cloud-init cho máy ảo

#### 1. Chọn máy ảo:

- Sau khi máy ảo được tạo xong, vào **Datacenter -> Node -> VM** mà bạn vừa tạo.

#### 2. Đi đến tab Cloud-init:

- Trong tab **Hardware** của máy ảo, bạn sẽ thấy **Cloud-init Disk**. Bạn cần cấu hình các thông số cần thiết trong **Cloud-init** cho máy ảo.

#### 3. Cấu hình các thông số Cloud-init:
Trong tab **Cloud-init**, bạn có thể thay đổi các thông số như:

- **User**: Tạo người dùng mới.

- **Password**: Thiết lập mật khẩu cho người dùng.

- **SSH Keys**: Thêm SSH key để có thể đăng nhập mà không cần mật khẩu.

- **Hostname**: Đặt hostname cho máy ảo.

- **IP configuration**: Cấu hình IP tĩnh hoặc DHCP cho máy ảo.

- **DNS**: Cấu hình DNS cho máy ảo.

#### Ví dụ, nếu bạn muốn cấu hình một số điều như:

- Tạo người dùng ubuntu

- Thêm một SSH key

- Đặt hostname là my-cloud-vm

- Cấu hình IP tĩnh

#### Các thông số sẽ như sau:

- **User**: Duy-cloud

- **Password**: (để trống hoặc chọn một mật khẩu)

- **SSH Key**: (Thêm SSH public key của bạn)

- **Hostname**: my-cloud-vm

- **IP Configuration**: Chọn Static và nhập các thông số như IP, Gateway, Subnet Mask.

<img width="958" height="729" alt="image" src="https://github.com/user-attachments/assets/f8e4494c-4624-41e6-9758-cebbb9c61f9e" />

#### Test máy ảo CloudInit
<img width="1919" height="737" alt="image" src="https://github.com/user-attachments/assets/97feb172-c22f-444b-8db7-f5212099d038" />







