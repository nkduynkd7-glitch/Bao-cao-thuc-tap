
# Cài đặt ONLYOFFICE Document Server và Kết nối với Nextcloud

## 1. Tổng quan kiến trúc

```yaml
User
  ↓ (SSO Keycloak)
Nextcloud (https://cloudnkd.km0.vn)
  ↓ (JWT + HTTP nội bộ)
ONLYOFFICE Document Server (http://172.16.20.61:8060)
```

---

## 2. Cài đặt ONLYOFFICE bằng Docker

### 2.1 Chạy ONLYOFFICE

```yaml
docker run -d \
  -p 8060:80 \
  --restart=always \
  --name onlyoffice \
  onlyoffice/documentserver
```

---

## 3. Cấu hình JWT cho ONLYOFFICE

```yaml
docker exec -it onlyoffice bash
nano /etc/onlyoffice/documentserver/local.json
```

```json
{
  "services": {
    "CoAuthoring": {
      "token": {
        "enable": {
          "request": { "inbox": true, "outbox": true },
          "browser": true
        }
      },
      "secret": {
        "browser": { "string": "D79U8XtrW2Tw2xHTSNBIC9sL39bNHwpE" },
        "inbox":   { "string": "D79U8XtrW2Tw2xHTSNBIC9sL39bNHwpE" },
        "outbox":  { "string": "D79U8XtrW2Tw2xHTSNBIC9sL39bNHwpE" },
        "session": { "string": "D79U8XtrW2Tw2xHTSNBIC9sL39bNHwpE" }
      }
    }
  }
}
```

```yaml
docker restart onlyoffice
```

---

## 4. Cấu hình Nextcloud

- Cài app ONLYOFFICE
- Settings → Administration → ONLYOFFICE

```text
Document Server URL: http://172.16.20.61:8060
JWT Secret: D79U8XtrW2Tw2xHTSNBIC9sL39bNHwpE
```

---

## 5. Kiểm tra

- Upload file `.docx`, `.excel`
- Mở file → chỉnh sửa bằng ONLYOFFICE

<img width="1919" height="984" alt="image" src="https://github.com/user-attachments/assets/09d4d6f5-c56d-488b-a742-3f69463c7289" />

---

## 6. Ghi chú

- ONLYOFFICE không dùng Keycloak
- Keycloak chỉ xác thực Nextcloud
