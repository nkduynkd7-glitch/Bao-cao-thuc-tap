# Báo cáo cài đặt và cấu hình Nextcloud, Keycloak (OIDC)

## 1. Mục tiêu

Thiết lập hệ thống Nextcloud chạy bằng Docker, xác thực người dùng thông
qua Keycloak sử dụng chuẩn OpenID Connect (OIDC). Người dùng đăng nhập
Nextcloud sẽ được chuyển hướng sang Keycloak để xác thực tập trung.

------------------------------------------------------------------------

## 2. Kiến trúc hệ thống

-   Ubuntu Server (VM)
-   Docker & Docker Compose
-   Nextcloud (container)
-   MariaDB/MySQL (container)
-   Keycloak (container)
-   Docker network dùng chung: `sso-net`

Luồng đăng nhập: Người dùng → Nextcloud → Keycloak → Nextcloud

------------------------------------------------------------------------

## 3. Cài đặt Docker trên Ubuntu

``` bash
sudo apt update
sudo apt install -y docker.io docker-compose-plugin
sudo systemctl enable --now docker
sudo usermod -aG docker $USER
newgrp docker
```

Kiểm tra:

``` bash
docker --version
docker compose version
```

------------------------------------------------------------------------

## 4. Triển khai Nextcloud bằng Docker

### docker-compose.yml

``` yaml
version: "3.8"

services:
  db:
    image: mariadb:10.11
    container_name: nextcloud_db
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: nextcloud
      MYSQL_USER: nextcloud
      MYSQL_PASSWORD: nextcloudpass
    volumes:
      - db:/var/lib/mysql

  app:
    image: nextcloud:29
    container_name: nextcloud_app
    restart: always
    ports:
      - "8080:80"
    environment:
      MYSQL_HOST: db
      MYSQL_DATABASE: nextcloud
      MYSQL_USER: nextcloud
      MYSQL_PASSWORD: nextcloudpass
    volumes:
      - nextcloud:/var/www/html
    depends_on:
      - db

volumes:
  db:
  nextcloud:
```

Chạy:

``` bash
docker compose up -d
```

Truy cập: http://IP:8080

------------------------------------------------------------------------

## 5. Triển khai Keycloak bằng Docker

### docker-compose.yml

``` yaml
version: "3.8"

services:
  keycloak:
    image: quay.io/keycloak/keycloak:24
    container_name: keycloak
    command: start-dev
    ports:
      - "8090:8080"
    environment:
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
```

Chạy:

``` bash
docker compose up -d
```

Truy cập: http://IP:8090/admin

------------------------------------------------------------------------

## 6. Kết nối Nextcloud và Keycloak vào cùng Docker network

``` bash
docker network create sso-net
docker network connect sso-net nextcloud_app
docker network connect sso-net keycloak
docker restart nextcloud_app keycloak
```

------------------------------------------------------------------------







